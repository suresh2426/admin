-------------HIVE-----------------
create database assg;
use assg;
create table flags(name string,landmass int,zone int,area int,population int,language int,religion
int,bars int,stripes int,colours int,red int,green int,blue int,gold int,white int,black int,orange
int,mainhue string,circles int,crosses int,saltires int,quarters int,sunstars int,crescent int,triangle
int,icon int,animate int,text int,topleft string,botright string) row format delimited fields terminated
by ',' stored as textfile;
----add dataset to hdfs----
hdfs dfs -copyFromLocal '/home/training/Desktop/Country Project Dataset.txt' '/user/hive/flag';
----then add the loaded dataset from hdfs to the table schema created above ----
LOAD DATA INPATH '/user/hive/flag' INTO TABLE flags;
---some queries----
***Count the number of countries based on land mass***
SELECT landmass, COUNT(*) FROM flags GROUP BY landmass;
***Find out top 5 country with Sum of bars and strips in a flag***
SELECT name, (bars + stripes) AS total FROM flags ORDER BY total DESC LIMIT 5;
***Count of countries with icon.***
SELECT COUNT(*)FROM flags  WHERE icon = 1;
*** Count of countries which have same top left and top right color in flag***
SELECT COUNT(*) FROM flags WHERE topleft = botright;
***Count the number of countries based on zone***
SELECT zone, COUNT(*) FROM flags GROUP BY zone;
***Find out the largest country in terms of area in the NE zone***
SELECT name, area FROM flags WHERE zone = 1 ORDER BY area DESC LIMIT 1;
***Find out least populated country in S.America landmass***
SELECT name, population FROM flags WHERE landmass = 2 ORDER BY population ASC LIMIT 1;
***Find out the largest speaking language among all countries***
SELECT language, COUNT(*) AS countrycount FROM flags GROUP BY language ORDER BY countrycount DESC LIMIT 1;
***Find most common colour among flags from all countries***
SELECT color, count FROM ( SELECT 'red' AS color, SUM(red) AS count FROM flags UNION ALL SELECT 'green' AS color, SUM(green) AS count FROM flags UNION ALL SELECT 'blue' AS color, SUM(blue) AS count FROM flags
UNION ALL SELECT 'gold' AS color, SUM(gold) AS count FROM flags UNION ALL SELECT 'white' AS color, SUM(white) AS count FROM flags UNION ALL SELECT 'black' AS color, SUM(black) AS count FROM flags UNION ALL SELECT 'orange' AS color, SUM(orange) AS count FROM flags) color_counts ORDER BY count DESC LIMIT 1;
***Sum of all circles present in all country flags***
SELECT SUM(circles) FROM flags;
***Count of countries which have both icon and text in flag***
SELECT COUNT(*) FROM flags WHERE icon = 1 AND text = 1;
-- 1) create table (each line is one record)
CREATE TABLE IF NOT EXISTS doc (text STRING) ROW FORMAT DELIMITED LINES TERMINATED BY '\n' STORED AS TEXTFILE;
-- 2) load local file into the table (adjust path as needed)
LOAD DATA LOCAL INPATH '/home/training/Desktop/Inputs/wordCountInput.txt' OVERWRITE INTO TABLE doc;
-- 3) word count using LATERAL VIEW explode(split(...))
SELECT word, COUNT(*) AS cnt FROM doc LATERAL VIEW explode(split(text, ' ')) t AS word GROUP BY word ORDER BY cnt DESC;
-- if run using hql saves file as hql extension
hive -f ' /hql-file-path ';
*** JOINS ***
1. Create Output Table (out1)
CREATE TABLE out1 (custno INT,firstname STRING,age INT,profession STRING,amount DOUBLE,product STRING) ROW FORMAT DELIMITED FIELDS TERMINATED BY ',';
2. Insert Into out1 (JOIN customers + transactions)
INSERT OVERWRITE TABLE out1 SELECT a.custno, a.firstname, a.age, a.profession, b.amount, b.product FROM customer a JOIN transactions b ON a.custno = b.custno;
3. 100 Records
SELECT * FROM out1 LIMIT 100;
4. Create out2 Table (Top Spending Customers)
CREATE TABLE out2 ( custno INT, firstname STRING, age INT, profession STRING, amount DOUBLE) ROW FORMAT DELIMITED FIELDS TERMINATED BY ',';
5. Insert Top 10 Spending Customers
INSERT OVERWRITE TABLE out2 SELECT c.custno, c.firstname, c.age, c.profession, SUM(t.amount) AS totalamt FROM customer c JOIN transactions t ON c.custno = t.custno GROUP BY c.custno, c.firstname, c.age, c.profession ORDER BY totalamt DESC LIMIT 10;
6. View out2
SELECT * FROM out2;
7. Create out3 (Age-based Category Table)
CREATE TABLE out3 (custno INT, firstname STRING, age INT, profess ion STRING, amount DOUBLE, product STRING, level S TRING)ROW FORMAT DELIMITEDFIELDS TERM INATED BY ',';
8. Insert Into out3 (Age → Level Mapping)
INSERT OVERWRITE TABLE out3 SELECT *, CASE WHEN age < 30 THEN 'low' WHEN age >= 30 AND age < 50 THEN 'middle' WHEN age >= 50 THEN 'old' ELSE 'others' END AS level FROM out1;
9. Display Sample Records
SELECT * FROM out3 LIMIT 10;
***Create another table for output***
create table out1(custno int, firstname string, age int, profession string, amount double, product string) row format delimited fields terminated by ',';
***Add data in table from existing 2 tables using JOIN***
insert overwrite table out1 select a.custno, a.firstname, a.age, a.profession, b.amount, b.product from customer a JOIN txnrecords b ON a.custno = b.custno;
***Display details of 10 customers having highest amount spent***
create table out2(custno int, firstname string, age int, profession string, amount double, product string, level string) row format delimited fields terminated by ‘,’;
insert overwrite table out2 select c.custno, c.firstname, c.age, c.profession, sum(t.amount) as totalamt from customer c join txnrecords t on c.custno = t.custno group by c.custno, c.firstname, c.age, c.profession order by totalamt desc limit 10;
***What is the oldest known movie in the database?Note that movies with unknown years have a value of 0 in the year field --‐ these do not belong in your answer.***
select name,year from movie where year!=0 order by year limit 1;
***List the name and year of all unrated movies (movies where the movie data has no related movierating data).***
select m.name, m.year from movie m LEFT OUTER JOIN movierating b on m.id = b.movieid where b.movieid is NULL;
***Produce an updated copy of the movie data with two new fields:numratings --‐ the number of ratings for the movie avgrating --‐ the average rating for the movie ( Unrated movies are not needed in this copy.)***
create table movie2 (id int, name string, year int, numratings int, avgratings double) row format delimited fields terminated by '\t';
select m.name, b.rating from movie m JOIN movierating b on m.id=b, movieid order by b.rating desc limit 10;

-------------PIG----------------- 
data= load '/user/training/input/CountryProjectDataset.txt' USING PigStorage(',') AS
(name:chararray ,landmass:int ,zone:int ,area:int ,population:int ,language:int ,religion:int ,bars:int
,stripes:int ,colours:int ,red:int ,green:int ,blue:int ,gold:int ,white:int ,black:int ,orange:int
,mainhue:chararray ,circles:int ,crosses:int ,saltires:int ,quarters:int ,sunstars:int ,crescent:int
,triangle:int ,icon:int ,animate:int ,text:int ,topleft:chararray ,botright:chararray);
---some queries---
***Count the number of countries based on landmass***
grouped = GROUP data BY landmass;
result = FOREACH grouped GENERATE group AS landmass, COUNT(data) AS country_count;
dump result;
***Find out top 5 country with Sum of bars and strips in a flag***
addsum = FOREACH data GENERATE name, (bars + stripes) AS total;
ordered = ORDER addsum BY total DESC;
top5 = LIMIT ordered 5;
DUMP top5;
***Count of countries with icon***
with_icon = FILTER data BY icon == 1;
count_icon = FOREACH (GROUP with_icon ALL) GENERATE COUNT(with_icon);
DUMP count_icon;
***Count of countries which have same top left and top right color in flag***
same_color = FILTER data BY topleft == botright;
result = FOREACH (GROUP same_color ALL) GENERATE COUNT(same_color);
DUMP result;
***Count number of countries based on zone.***
grouped = GROUP data BY zone;
result = FOREACH grouped GENERATE group AS zone, COUNT(data) AS country_count;
DUMP result;
***Find out largest county in terms of area in NE zone***
ne_zone = FILTER data BY zone == 1;
max_country = ORDER ne_zone BY area DESC;
largest = LIMIT max_country 1;
DUMP largest;
***Find out least populated country in S.America landmass***
south_america = FILTER data BY landmass == 2;
ordered = ORDER south_america BY population ASC;
least = LIMIT ordered 1;
DUMP least;
***Find out largest speaking language among all countries***
grouped = GROUP data BY language;
counted = FOREACH grouped GENERATE group AS language, COUNT(data) AS country_count;
ordered = ORDER counted BY country_count DESC;
top1 = LIMIT ordered 1;
DUMP top1;
***Find most common colour among flags from all countries***
colors = FOREACH data GENERATE(red == 1 ? 'red' : null) AS color1,(green == 1 ? 'green' : null) AS color2,(blue == 1 ? 'blue' : null) AS color3,(gold == 1 ? 'gold' : null) AS color4,(white == 1 ? 'white' : null) AS color5,(black == 1 ? 'black' : null) AS color6,(orange == 1 ? 'orange' : null) AS color7;
flat = FOREACH colors GENERATE FLATTEN((TOTUPLE(color1,color2,color3,color4,color5,color6,color7)));
filtered = FILTER flat BY $0 IS NOT NULL;
grouped = GROUP filtered BY $0;
result = FOREACH grouped GENERATE group AS color, COUNT(filtered) AS count;
ordered = ORDER result BY count DESC;
top1 = LIMIT ordered 1;
DUMP top1;
***Sum of all circles present in all country flags***
grouped = GROUP data ALL;
result = FOREACH grouped GENERATE SUM(data.circles);
DUMP result;
***Count of countries which have both icon and text in flag***
both = FILTER data BY icon == 1 AND text == 1;
result = FOREACH (GROUP both ALL) GENERATE COUNT(both);
DUMP result;
-- load file (one line per record)
A = LOAD '/user/training/shakespere/poems' AS (line:chararray);
-- tokenize each line into a bag of tokens
B = FOREACH A GENERATE TOKENIZE(line) AS tokens;
-- flatten tokens so each row is a single word
C = FOREACH B GENERATE FLATTEN(tokens) AS word_raw;
-- normalize: trim and lowercase, and filter out empty strings
W = FOREACH C GENERATE LOWER(TRIM(word_raw)) AS word;
W = FILTER W BY word IS NOT NULL AND word != '';
-- group by word and count occurrences
D = GROUP W BY word;
E = FOREACH D GENERATE group AS word, COUNT(W) AS cnt;
-- order by count descending (most frequent first)
F = ORDER E BY cnt DESC;
-- store results
STORE F INTO '/user/training/pigWordCount' USING PigStorage(',');
***count the number of associated sub-patents for each patent is in this dataset***
A = LOAD '/user/training/patentInput' using PigStorage(' ') as
(pid:int, spid:double);
B = group A by pid;
C = foreach B generate group, COUNT(A);
store C into '/user/training/subpatentOutput2';
*** To find the total number of crimes which occurred in all the states in the year 2006.***
A = LOAD...
B = group A ALL;
C = foreach B generate group, SUM(A.year_2006);
store C into 'output location';
***Calculate the number of females (age between 18-30 years) who were victims in different crimes in different states.***
A = LOAD...
B = group A by state;
C = foreach B generate group, SUM(A.f_18_30);
store C into 'output location'
***Which state have highest rape cases across all years***
A= LOAD...
B = FILTER A BY REPLACE(crimehead, '"', '') =='RAPE';
C = FOREACH B GENERATE state, crimehead, SUM(TOBAG(year_2001,year_2002,all year)) AS all_years;
D = group C bystate;
E = foreach D generate group as state, MAX(c.allyears);
F = order E by $1 desc;
G = limit F 1;
store G into 'output location';
***Find the maximum dowry deaths happened in which year and in which state***
A = LOAD...
B = FILTER A BY REPLACE(crimehead,'"','')=='DOWRY DEATHS';
C = FOREACH B GENERATE state, TOBAG(
            TOTUPLE('2001', year_2001),
            TOTUPLE('2002', year_2002),
            TOTUPLE('2003', year_2003),
            TOTUPLE('2004', year_2004),
      ) AS year_counts;
D = FOREACH C GENERATE state, FLATTEN(year_counts) AS (year:chararray, count:int);
E = ORDER D BY count DESC;
F = LIMIT E 1;
store F into 'output location';
***Calculate the number of males (age between 45-60 years) who were victims in “Kidnapping and abduction” in different states***
A = LOAD
B = FILTER A BY REPALCE (crimehead, '"','')=='Kidnapping and Abduction';
C = GROUP B BY state;
D = FOREACH C GENERATE group AS state, COUNT(B.m_45_0) AS male-45_60_victims;
store D into 'output lcaotion';
