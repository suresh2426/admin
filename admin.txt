-------------HIVE-----------------
create database assg;
use assg;
create table flags(name string,landmass int,zone int,area int,population int,language int,religion
int,bars int,stripes int,colours int,red int,green int,blue int,gold int,white int,black int,orange
int,mainhue string,circles int,crosses int,saltires int,quarters int,sunstars int,crescent int,triangle
int,icon int,animate int,text int,topleft string,botright string) row format delimited fields terminated
by ',' stored as textfile;
----add dataset to hdfs----
hdfs dfs -copyFromLocal '/home/training/Desktop/Country Project Dataset.txt' '/user/hive/flag';
----then add the loaded dataset from hdfs to the table schema created above ----
LOAD DATA INPATH '/user/hive/flag' INTO TABLE flags;
---some queries----
***Count the number of countries based on land mass***
SELECT landmass, COUNT(*) FROM flags GROUP BY landmass;
***Find out top 5 country with Sum of bars and strips in a flag***
SELECT name, (bars + stripes) AS total FROM flags ORDER BY total DESC LIMIT 5;
***Count of countries with icon.***
SELECT COUNT(*)FROM flags  WHERE icon = 1;
*** Count of countries which have same top left and top right color in flag***
SELECT COUNT(*) FROM flags WHERE topleft = botright;
***Count the number of countries based on zone***
SELECT zone, COUNT(*) FROM flags GROUP BY zone;
***Find out the largest country in terms of area in the NE zone***
SELECT name, area FROM flags WHERE zone = 1 ORDER BY area DESC LIMIT 1;
***Find out least populated country in S.America landmass***
SELECT name, population FROM flags WHERE landmass = 2 ORDER BY population ASC LIMIT 1;
***Find out the largest speaking language among all countries***
SELECT language, COUNT(*) AS countrycount FROM flags GROUP BY language ORDER BY countrycount DESC LIMIT 1;
***Find most common colour among flags from all countries***
SELECT color, count FROM ( SELECT 'red' AS color, SUM(red) AS count FROM flags UNION ALL SELECT 'green' AS color, SUM(green) AS count FROM flags UNION ALL SELECT 'blue' AS color, SUM(blue) AS count FROM flags
UNION ALL SELECT 'gold' AS color, SUM(gold) AS count FROM flags UNION ALL SELECT 'white' AS color, SUM(white) AS count FROM flags UNION ALL SELECT 'black' AS color, SUM(black) AS count FROM flags UNION ALL SELECT 'orange' AS color, SUM(orange) AS count FROM flags) color_counts ORDER BY count DESC LIMIT 1;
***Sum of all circles present in all country flags***
SELECT SUM(circles) FROM flags;
***Count of countries which have both icon and text in flag***
SELECT COUNT(*) FROM flags WHERE icon = 1 AND text = 1;
-------------PIG----------------- 
data= load '/user/training/input/CountryProjectDataset.txt' USING PigStorage(',') AS
(name:chararray ,landmass:int ,zone:int ,area:int ,population:int ,language:int ,religion:int ,bars:int
,stripes:int ,colours:int ,red:int ,green:int ,blue:int ,gold:int ,white:int ,black:int ,orange:int
,mainhue:chararray ,circles:int ,crosses:int ,saltires:int ,quarters:int ,sunstars:int ,crescent:int
,triangle:int ,icon:int ,animate:int ,text:int ,topleft:chararray ,botright:chararray);
---some queries---
***Count the number of countries based on landmass***
grouped = GROUP data BY landmass;
result = FOREACH grouped GENERATE group AS landmass, COUNT(data) AS country_count;
dump result;
***Find out top 5 country with Sum of bars and strips in a flag***
addsum = FOREACH data GENERATE name, (bars + stripes) AS total;
ordered = ORDER addsum BY total DESC;
top5 = LIMIT ordered 5;
DUMP top5;
***Count of countries with icon***
with_icon = FILTER data BY icon == 1;
count_icon = FOREACH (GROUP with_icon ALL) GENERATE COUNT(with_icon);
DUMP count_icon;
***Count of countries which have same top left and top right color in flag***
same_color = FILTER data BY topleft == botright;
result = FOREACH (GROUP same_color ALL) GENERATE COUNT(same_color);
DUMP result;
***Count number of countries based on zone.***
grouped = GROUP data BY zone;
result = FOREACH grouped GENERATE group AS zone, COUNT(data) AS country_count;
DUMP result;
***Find out largest county in terms of area in NE zone***
ne_zone = FILTER data BY zone == 1;
max_country = ORDER ne_zone BY area DESC;
largest = LIMIT max_country 1;
DUMP largest;
***Find out least populated country in S.America landmass***
south_america = FILTER data BY landmass == 2;
ordered = ORDER south_america BY population ASC;
least = LIMIT ordered 1;
DUMP least;
***Find out largest speaking language among all countries***
grouped = GROUP data BY language;
counted = FOREACH grouped GENERATE group AS language, COUNT(data) AS country_count;
ordered = ORDER counted BY country_count DESC;
top1 = LIMIT ordered 1;
DUMP top1;
***Find most common colour among flags from all countries***
colors = FOREACH data GENERATE(red == 1 ? 'red' : null) AS color1,(green == 1 ? 'green' : null) AS color2,(blue == 1 ? 'blue' : null) AS color3,(gold == 1 ? 'gold' : null) AS color4,(white == 1 ? 'white' : null) AS color5,(black == 1 ? 'black' : null) AS color6,(orange == 1 ? 'orange' : null) AS color7;
flat = FOREACH colors GENERATE FLATTEN((TOTUPLE(color1,color2,color3,color4,color5,color6,color7)));
filtered = FILTER flat BY $0 IS NOT NULL;
grouped = GROUP filtered BY $0;
result = FOREACH grouped GENERATE group AS color, COUNT(filtered) AS count;
ordered = ORDER result BY count DESC;
top1 = LIMIT ordered 1;
DUMP top1;
***Sum of all circles present in all country flags***
grouped = GROUP data ALL;
result = FOREACH grouped GENERATE SUM(data.circles);
DUMP result;
***Count of countries which have both icon and text in flag***
both = FILTER data BY icon == 1 AND text == 1;
result = FOREACH (GROUP both ALL) GENERATE COUNT(both);
DUMP result;
